# ๐ง ูุธุงู ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ ููุตูุงูุฉ - HMS Background System

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุญุชูู ูุธุงู HMS ุนูู ูุธุงู ูุฑุงูุจุฉ ุชููุงุฆู ูุชุทูุฑ ูุนูู ูู ุงูุฎูููุฉ ูุฅุฏุงุฑุฉ ุฌููุน ุนูููุงุช ุงูุตูุงูุฉ ุฏูู ุชุฏุฎู ุจุดุฑู. ุงููุธุงู ูุชููู ูู ูููููู ุฑุฆูุณููู:

- **๐ Signals (`signals.py`)**: ููุงุณุชุฌุงุจุฉ ุงูููุฑูุฉ ููุฃุญุฏุงุซ
- **โ๏ธ Background Tasks (`tasks.py`)**: ูููุฑุงูุจุฉ ุงููุณุชูุฑุฉ ูุงูููุงู ุงููุฌุฏููุฉ

---

## ๐ ูุธุงู ุงูุฅุดุงุฑุงุช (Signals System)

### ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ

#### 1. ๐ฑ ุฅูุดุงุก ุฑููุฒ QR ุชููุงุฆูุงู
```python
@receiver(post_save)
def generate_qr_code_on_save()
```
- **ุงููุฏู**: ุฅูุดุงุก ุฑููุฒ QR ูููุฑุถู ูุงูุฃุฌูุฒุฉ ูุงููุณุชุฎุฏููู ุชููุงุฆูุงู
- **ุงูุชุดุบูู**: ุนูุฏ ุฅูุดุงุก ุฃู ุนูุตุฑ ุฌุฏูุฏ
- **ุงููุงุฆุฏุฉ**: ุชุชุจุน ุณุฑูุน ูุณูู ููุฃุตูู

#### 2. ๐ ุงูุชุญููู ุงูุชููุงุฆู ููุจูุงุบุงุช
```python
@receiver(post_save, sender=ServiceRequest)
def auto_create_work_order()
```
- **ุงููุฏู**: ุชุญููู ุงูุจูุงุบุงุช ุฅูู ุฃูุงูุฑ ุดุบู ุชููุงุฆูุงู
- **ุงููุนุงูุฌุฉ**: 
  - ุชุญุฏูุฏ SLA ุงูููุงุณุจ ุญุณุจ ููุน ุงูุฌูุงุฒ ูุงูุฃููููุฉ
  - ุญุณุงุจ ููุงุนูุฏ ุงูุงุณุชุฌุงุจุฉ ูุงูุญู
  - ุฅูุดุงุก ุฃูุฑ ุงูุดุบู ูุน ุงูููุงุนูุฏ ุงููุฌุฏููุฉ
- **ุงููุชูุฌุฉ**: ุงุณุชุฌุงุจุฉ ููุฑูุฉ ูุฌููุน ุงูุจูุงุบุงุช

#### 3. ๐ ุชุญุฏูุซ ุญุงูุงุช ุงูุจูุงุบุงุช
```python
@receiver(post_save, sender=WorkOrder)
def update_service_request_status()
```
- **ุงููุฏู**: ูุฒุงููุฉ ุญุงูุงุช ุงูุจูุงุบุงุช ูุน ุฃูุงูุฑ ุงูุดุบู
- **ุงููุนุงูุฌุฉ**: ุฑุจุท ุชููุงุฆู ุจูู ุญุงูุงุช ุงูุนูู
- **ุงููุงุฆุฏุฉ**: ุชุชุจุน ุฏููู ูุชูุฏู ุงูุนูู

#### 4. ๐๏ธ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ ุงูุชููุงุฆูุฉ
```python
@receiver(post_save, sender=PreventiveMaintenanceSchedule)
def setup_pm_schedule_automation()
```
- **ุงููุฏู**: ุฅุนุฏุงุฏ ุฌุฏุงูู ุงูุตูุงูุฉ ุงูููุงุฆูุฉ
- **ุงููุนุงูุฌุฉ**: ุชุญุฏูุฏ ุงูููุงุนูุฏ ุงูุชุงููุฉ ููุตูุงูุฉ
- **ุงูุชูุงูู**: ูุนูู ูุน ูุธุงู ุงููุฑุงูุจุฉ ุงููุฌุฏููุฉ

#### 5. ๐จ ุงูุชุดุงู ุงููุดุงูู ุงูุชููุงุฆู
```python
@receiver(post_save, sender=DeviceUsageLog)
def auto_create_maintenance_request()
```
- **ุงููุฏู**: ุฅูุดุงุก ุจูุงุบุงุช ุชููุงุฆูุฉ ุนูุฏ ุงูุชุดุงู ูุดุงูู
- **ุงููุนุงูุฌุฉ**: 
  - ุชุญููู ุญุงูุฉ ุงูุฌูุงุฒ ูู ุงูุชููุฏ ุงููููู
  - ุชุญุฏูุฏ ุฏุฑุฌุฉ ุงูุฎุทูุฑุฉ
  - ุฅูุดุงุก ุจูุงุบ ููุงุณุจ ูููุดููุฉ
- **ุงููุงุฆุฏุฉ**: ุงุณุชุฌุงุจุฉ ุณุฑูุนุฉ ูููุดุงูู

#### 6. ๐ ุฅุฏุงุฑุฉ ูุตูููุฉ SLA
```python
@receiver(post_save, sender=DeviceCategory)
def auto_generate_sla_matrix_for_category()
```
- **ุงููุฏู**: ุฅูุดุงุก ูุตูููุฉ SLA ุชููุงุฆูุงู ูููุฆุงุช ุงูุฌุฏูุฏุฉ
- **ุงููุนุงูุฌุฉ**: ุฑุจุท ูู ูุฆุฉ ุฌูุงุฒ ุจูุนุงููุฑ SLA ุงูููุงุณุจุฉ
- **ุงููุชูุฌุฉ**: ุถูุงู ุชุทุจูู ูุนุงููุฑ ุงูุฎุฏูุฉ ุนูู ุฌููุน ุงูุฃุฌูุฒุฉ

---

## โ๏ธ ูุธุงู ุงูููุงู ุงููุฌุฏููุฉ (Background Tasks)

### ๐๏ธ ูููู ุงููุธุงู

```python
class MaintenanceTaskRunner:
    def __init__(self):
        self.running = False
        self.thread = None
```

### ๐ ุฌุฏููุฉ ุงูููุงู

| ุงููููุฉ | ุงูุชูุฑุงุฑ | ุงูููุช | ุงููุตู |
|--------|---------|-------|--------|
| **ูุญุต ุงูุตูุงูุฉ ุงูููุงุฆูุฉ** | ูู 30 ุฏูููุฉ | ูุณุชูุฑ | ุฅูุดุงุก ุฃูุงูุฑ ุงูุตูุงูุฉ ุงููุณุชุญูุฉ |
| **ูุฑุงูุจุฉ ุงูุชููู** | ูู ุฏูููุฉ | ูุณุชูุฑ | ุชุชุจุน ุฃููุงุช ุชููู ุงูุฃุฌูุฒุฉ |
| **ูุญุต ุงูุชูุงูุงุช SLA** | ูู ุณุงุนุชูู | ูุณุชูุฑ | ูุฑุงูุจุฉ ุงูุชุฃุฎูุฑ ูู ุงูุงุณุชุฌุงุจุฉ |
| **ุงููุญุต ุงููููู** | ููููุงู | 8:00 ุต | ูุญุต ุงูุฃุฌูุฒุฉ ููุทุน ุงูุบูุงุฑ |
| **ุงูุชูุงุฑูุฑ ุงูููููุฉ** | ููููุงู | 6:00 ู | ุฅุฑุณุงู ููุฎุต ุงูููู |

### ๐ ุงูููุงู ุงูุชูุตูููุฉ

#### 1. ๐๏ธ ูุฑุงูุจุฉ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ
```python
def _check_pm_schedules(self):
```
- **ุงููุธููุฉ**: ูุญุต ุงูุฌุฏุงูู ุงููุณุชุญูุฉ ูุฅูุดุงุก ุฃูุงูุฑ ุงูุดุบู
- **ุงููุนุงูุฌุฉ**:
  - ุงูุจุญุซ ุนู ุฌุฏุงูู ุงูุตูุงูุฉ ุงููุณุชุญูุฉ
  - ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุนูุงู ููุชูุญุฉ
  - ุฅูุดุงุก ุจูุงุบ ูุฃูุฑ ุดุบู ุชููุงุฆูุงู
  - ุชุญุฏูุซ ููุนุฏ ุงูุตูุงูุฉ ุงูุชุงููุฉ
- **ุงูุณุฌูุงุช**: ุชุณุฌูู ููุตู ูุฌููุน ุงูุนูููุงุช

#### 2. โฑ๏ธ ูุฑุงูุจุฉ ุฃููุงุช ุงูุชููู
```python
def _monitor_downtime_schedules(self):
```
- **ุงููุธููุฉ**: ุชุชุจุน ุชููุงุฆู ูุฃููุงุช ุชููู ุงูุฃุฌูุฒุฉ
- **ุงููุนุงูุฌุฉ**:
  - ูุญุต ุงูุฃุนูุงู ุงููุดุทุฉ (ุฃูุงูุฑ ุงูุดุบู ูุทูุจุงุช ุงูุฎุฏูุฉ)
  - ุฅูุดุงุก/ุชุญุฏูุซ ุณุฌูุงุช ุงูุชููู
  - ุญุณุงุจ ุงูุชูุงููู ุงููุงููุฉ
  - ุฅููุงุก ุงูุณุฌูุงุช ุนูุฏ ุงูุชูุงู ุงูุนูู

#### 3. ๐ ูุญุต ุงูุชูุงูุงุช SLA
```python
def _check_sla_violations(self):
```
- **ุงููุธููุฉ**: ูุฑุงูุจุฉ ุงูุงูุชุฒุงู ุจูุนุงููุฑ ุงูุฎุฏูุฉ
- **ุงููุนุงูุฌุฉ**:
  - ูุญุต ุงูุจูุงุบุงุช ูุฃูุงูุฑ ุงูุดุบู ุงููุชุฃุฎุฑุฉ
  - ุฅุฑุณุงู ุชูุจููุงุช ูููุณุคูููู
  - ุชุณุฌูู ุงูุงูุชูุงูุงุช
- **ุงููุงุฆุฏุฉ**: ุถูุงู ุฌูุฏุฉ ุงูุฎุฏูุฉ

#### 4. ๐ ุงููุญุต ุงููููู
```python
def _daily_maintenance_check(self):
```
- **ุงููุธููุฉ**: ูุญุต ุดุงูู ูููุธุงู
- **ุงููุนุงูุฌุฉ**:
  - ูุญุต ุงูุฃุฌูุฒุฉ ุงูุชู ุชุญุชุงุฌ ุตูุงูุฉ
  - ูุฑุงูุจุฉ ูุฎุฒูู ูุทุน ุงูุบูุงุฑ
  - ุชุญุฏูุฏ ุงูุฃููููุงุช
- **ุงูุชูููุช**: ูู ููู ูู ุงูุณุงุนุฉ 8:00 ุตุจุงุญุงู

---

## ๐ ุชุฏูู ุงูุนูู ุงูุชููุงุฆู

### ๐ ุณููุงุฑูู: ุจูุงุบ ุตูุงูุฉ ุฌุฏูุฏ

```mermaid
graph TD
    A[ุฅูุดุงุก ุจูุงุบ ุตูุงูุฉ] --> B[Signal: auto_create_work_order]
    B --> C[ุชุญุฏูุฏ SLA ุงูููุงุณุจ]
    C --> D[ุฅูุดุงุก ุฃูุฑ ุดุบู ุชููุงุฆูุงู]
    D --> E[Task: ูุฑุงูุจุฉ ุงูุชููู]
    E --> F[ุฅูุดุงุก ุณุฌู ุชููู]
    F --> G[ุชุญุฏูุซ ูุณุชูุฑ ููุญุงูุฉ]
    G --> H[ุฅููุงุก ุงูุชููู ุนูุฏ ุงูุฅููุงู]
```

### ๐๏ธ ุณููุงุฑูู: ุตูุงูุฉ ููุงุฆูุฉ

```mermaid
graph TD
    A[ุฌุฏูู ุตูุงูุฉ ููุงุฆูุฉ] --> B[Task: ูุญุต ูู 30 ุฏูููุฉ]
    B --> C{ููุนุฏ ูุณุชุญูุ}
    C -->|ูุนู| D[ุฅูุดุงุก ุจูุงุบ ุชููุงุฆู]
    C -->|ูุง| B
    D --> E[ุฅูุดุงุก ุฃูุฑ ุดุบู]
    E --> F[ุชุญุฏูุซ ุงูููุนุฏ ุงูุชุงูู]
    F --> G[ูุฑุงูุจุฉ ุงูุชููู]
```

---

## ๐ฏ ุงูููุงุฆุฏ ุงูุฑุฆูุณูุฉ

### โ ุงูุฃุชูุชุฉ ุงููุงููุฉ
- **ูุง ุชุฏุฎู ุจุดุฑู**: ุงููุธุงู ูุนูู ุจุดูู ูุณุชูู
- **ุงุณุชุฌุงุจุฉ ููุฑูุฉ**: ูุนุงูุฌุฉ ุงูุจูุงุบุงุช ูู ุซูุงูู
- **ุฏูุฉ ุนุงููุฉ**: ุชูููู ุงูุฃุฎุทุงุก ุงูุจุดุฑูุฉ

### ๐ ุงููุฑุงูุจุฉ ุงููุณุชูุฑุฉ
- **24/7**: ุนูู ูุณุชูุฑ ุฏูู ุงููุทุงุน
- **ุชุชุจุน ุดุงูู**: ุฌููุน ุงูุฃุฌูุฒุฉ ูุงูุนูููุงุช
- **ุชูุงุฑูุฑ ุฏูููุฉ**: ุจูุงูุงุช ููุซููุฉ ูููุฑุงุฑุงุช

### ๐ฐ ุชูููุฑ ุงูุชูุงููู
- **ุชูููู ุงูุชููู**: ุงูุชุดุงู ูุจูุฑ ูููุดุงูู
- **ุตูุงูุฉ ููุงุฆูุฉ**: ููุน ุงูุฃุนุทุงู ุงููุจูุฑุฉ
- **ููุงุกุฉ ุงูููุงุฑุฏ**: ุงุณุชุบูุงู ุฃูุซู ูููุฑู

### ๐ ุงูุดูุงููุฉ ูุงููุณุงุกูุฉ
- **ุณุฌูุงุช ููุตูุฉ**: ุชุชุจุน ูุงูู ููุนูููุงุช
- **ูุนุงููุฑ SLA**: ุถูุงู ุฌูุฏุฉ ุงูุฎุฏูุฉ
- **ุชูุจููุงุช ููุฑูุฉ**: ุฅุดุนุงุฑ ุจุงููุดุงูู

---

## ๐ ุงูุชุดุบูู ูุงูุฅุฏุงุฑุฉ

### ุจุฏุก ุงูุชุดุบูู
```python
from maintenance.tasks import start_maintenance_tasks
start_maintenance_tasks()
```

### ุฅููุงู ุงููุธุงู
```python
from maintenance.tasks import stop_maintenance_tasks
stop_maintenance_tasks()
```

### ูุฑุงูุจุฉ ุงูุณุฌูุงุช
```bash
# ุนุฑุถ ุณุฌูุงุช ุงููุธุงู
tail -f logs/maintenance.log

# ููุชุฑุฉ ุณุฌูุงุช ูุญุฏุฏุฉ
grep "DEBUG" logs/maintenance.log
```

---

## ๐ง ุงูุฅุนุฏุงุฏุงุช ูุงูุชุฎุตูุต

### ุชุนุฏูู ูุชุฑุงุช ุงููุฑุงูุจุฉ
```python
# ูู tasks.py - ุชุนุฏูู ุงูุฌุฏููุฉ
schedule.every(30).minutes.do(self._check_pm_schedules)  # ุงูุตูุงูุฉ ุงูููุงุฆูุฉ
schedule.every(1).minutes.do(self._monitor_downtime_schedules)  # ูุฑุงูุจุฉ ุงูุชููู
```

### ุฅุนุฏุงุฏ ูุนุงููุฑ SLA
- ุชุญุฏูุฏ ุฃููุงุช ุงูุงุณุชุฌุงุจุฉ ุญุณุจ ููุน ุงูุฌูุงุฒ
- ุถุจุท ูุณุชููุงุช ุงูุชุตุนูุฏ
- ุชุฎุตูุต ุงูุชูุจููุงุช

### ุชุฎุตูุต ุงูุชูุงุฑูุฑ
- ุชุญุฏูุฏ ูุญุชูู ุงูุชูุงุฑูุฑ ุงูููููุฉ
- ุถุจุท ููุงุฆู ุงููุณุชูููู
- ุชุนุฏูู ุฃููุงุช ุงูุฅุฑุณุงู

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ูุงููุคุดุฑุงุช

ุงููุธุงู ูููุฑ ูุคุดุฑุงุช ุฃุฏุงุก ุดุงููุฉ:

- **ูุนุฏู ุงูุงุณุชุฌุงุจุฉ**: ูุชูุณุท ููุช ุงูุงุณุชุฌุงุจุฉ ููุจูุงุบุงุช
- **ููุงุกุฉ ุงูุตูุงูุฉ**: ูุณุจุฉ ุงูุฃุนูุงู ุงูููุชููุฉ ูู ุงูููุช ุงููุญุฏุฏ
- **ุชููุฑ ุงูุฃุฌูุฒุฉ**: ูุณุจุฉ ููุช ุชุดุบูู ุงูุฃุฌูุฒุฉ
- **ุงูุชูุงููู**: ุชุชุจุน ุชูุงููู ุงูุตูุงูุฉ ูุงูุชููู

---

## ๐ก๏ธ ุงูุฃูุงู ูุงูููุซูููุฉ

### ุขููุงุช ุงูุญูุงูุฉ
- **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**: ุงูุชุนุงูู ูุน ุงูุงุณุชุซูุงุกุงุช ุจุฃูุงู
- **ุงููุณุฎ ุงูุงุญุชูุงุทู**: ุญูุธ ุงูุจูุงูุงุช ุงูุญุฑุฌุฉ
- **ุงููุฑุงูุจุฉ**: ุชุณุฌูู ุฌููุน ุงูุนูููุงุช

### ุงูุงุณุชูุฑุงุฑ
- **ุฅุนุงุฏุฉ ุงูุชุดุบูู ุงูุชููุงุฆู**: ูู ุญุงูุฉ ุงูุฃุฎุทุงุก
- **ุงูุชุญูู ูู ุงูุตุญุฉ**: ูุญุต ุณูุงูุฉ ุงูุจูุงูุงุช
- **ุงูุชูุจููุงุช**: ุฅุดุนุงุฑ ุจุงููุดุงูู ุงููููุฉ

---

## ๐ ุงูุฏุนู ูุงูุตูุงูุฉ

### ุงุณุชูุดุงู ุงูุฃุฎุทุงุก
1. **ูุญุต ุงูุณุฌูุงุช**: ูุฑุงุฌุนุฉ ูููุงุช ุงูุณุฌู
2. **ุญุงูุฉ ุงููุธุงู**: ุงูุชุญูู ูู ุชุดุบูู ุงูููุงู
3. **ูุงุนุฏุฉ ุงูุจูุงูุงุช**: ูุญุต ุณูุงูุฉ ุงูุจูุงูุงุช

### ุงูุชุญุฏูุซ ูุงูุชุทููุฑ
- **ุฅุถุงูุฉ ููุงู ุฌุฏูุฏุฉ**: ุชูุณูุน ูุธุงุฆู ุงููุธุงู
- **ุชุญุณูู ุงูุฃุฏุงุก**: ุชุทููุฑ ุงูุฎูุงุฑุฒููุงุช
- **ุงูุชูุงูู**: ุฑุจุท ุฃูุธูุฉ ุฎุงุฑุฌูุฉ

---

*ุชู ุชุทููุฑ ูุฐุง ุงููุธุงู ูุถูุงู ุฃุนูู ูุณุชููุงุช ุงูููุงุกุฉ ูุงูููุซูููุฉ ูู ุฅุฏุงุฑุฉ ุงูุตูุงูุฉ ุงูุทุจูุฉ* ๐ฅโจ
