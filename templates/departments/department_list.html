{% extends "base.html" %}

{% block title %}Department List{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h2 class="m-0"><i class="bi bi-diagram-3 me-2"></i>Departments</h2>
        <div class="d-flex align-items-center" style="gap:.5rem">
            <a href="{% url 'manager:department_add' %}" class="btn btn-soft-success">
                <i class="bi bi-plus-circle me-1"></i> <span class="d-none d-sm-inline">Add Department</span>
            </a>
        </div>
    </div>

    <!-- Scoped styles for the tree -->
    <style>
      #departmentTree .list-group-item{
        display:flex; align-items:center; gap:.6rem; border-radius:10px; border:1px solid var(--table-border-color);
        padding:10px 12px; background-color: var(--card-bg);
      }
      #departmentTree .list-group{ gap:.4rem; }
      #departmentTree .toggle-icon{ cursor:pointer; width:1.5rem; height:1.5rem; display:flex; align-items:center; justify-content:center; border-radius:6px; }
      #departmentTree .toggle-icon:hover{ background: rgba(0,0,0,.06); }
      body.dark-mode #departmentTree .toggle-icon:hover{ background: rgba(255,255,255,.08); }
      #departmentTree a.name-link{ color: inherit; text-decoration: none; font-weight: 500; }
      #departmentTree .actions{ margin-inline-start:auto; display:flex; align-items:center; gap:.35rem; }
      #departmentTree ul.list-group{ border: none; background: transparent; }
    </style>

    <!-- شجرة الأقسام -->
    <div class="card p-3 shadow-sm">
        <ul class="list-group" id="departmentTree">
            {% for department in departments %}
                {% if not department.parent %} <!-- الأقسام الرئيسية فقط -->
                    {% include "departments/department_node.html" with department=department %}
                {% endif %}
            {% empty %}
                <li class="list-group-item text-center text-muted py-4">
                    <i class="bi bi-emoji-frown me-2" style="font-size: 1.5rem;"></i>No departments found.
                </li>
            {% endfor %}
        </ul>
    </div>
</div>

<script>
    // إبقاء الشجرة مفتوحة افتراضياً
    document.addEventListener("DOMContentLoaded", function () {
        const treeItems = document.querySelectorAll("#departmentTree ul");
        treeItems.forEach((item) => item.classList.remove("d-none"));
    });

    function toggleChildren(element) {
        const icon = element.querySelector("i");
        const nextUl = element.parentElement.querySelector("ul");
        if (nextUl) {
            nextUl.classList.toggle("d-none");
            if (icon.classList.contains("bi-chevron-right")) {
                icon.classList.remove("bi-chevron-right");
                icon.classList.add("bi-chevron-down");
            } else {
                icon.classList.remove("bi-chevron-down");
                icon.classList.add("bi-chevron-right");
            }
        }
    }
</script>
{% endblock %}