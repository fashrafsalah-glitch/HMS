{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2>ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²</h2>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-primary">ğŸ’¾ Ø­ÙØ¸</button>
        <a href="{% url 'maintenance:device_list' %}" class="btn btn-secondary">ğŸ”™ Ø±Ø¬ÙˆØ¹</a>
    </form>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $('#id_department').change(function () {
    const departmentId = $(this).val();
    if (departmentId) {
      $.ajax({
        url: '{% url "maintenance:get_rooms" %}',
        data: { department_id: departmentId },
        success: function (data) {
          $('#room-container').html(data);
          $('#id_room').change();  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
        }
      });
    } else {
      $('#room-container').html('<select id="id_room" name="room" class="form-control"><option value="">---------</option></select>');
      $('#bed-container').html('<select id="id_bed" name="bed" class="form-control"><option value="">---------</option></select>');
    }
  });

  $(document).on('change', '#id_room', function () {
    const roomId = $(this).val();
    if (roomId) {
      $.ajax({
        url: '{% url "maintenance:get_beds" %}',
        data: { room_id: roomId },
        success: function (data) {
          $('#bed-container').html(data);
        }
      });
    } else {
      $('#bed-container').html('<select id="id_bed" name="bed" class="form-control"><option value="">---------</option></select>');
    }
  });

  $(document).ready(function () {
    $('#id_department').change();  // Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
  });
</script>
{% endblock %}