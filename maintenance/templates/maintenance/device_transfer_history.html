{% extends "base.html" %}

{% block title %}سجل حركة الجهاز: {{ device.name }}{% endblock %}

{% block content %}
<div class="container my-4">
    <h3 class="text-center mb-4">سجل حركة الجهاز: {{ device.name }}</h3>

    {% if transfers %}
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                 <th>تسلسل</th>
                <th>من قسم</th>
                <th>من غرفة</th>
                <th>إلى قسم</th>
                <th>إلى غرفة</th>
                <th>طالب النقل</th>
                <th>وقت الطلب</th>
                <th>الموافقة</th>
                <th>الوقت</th>
            </tr>
        </thead>
        <tbody>
            {% for t in transfers %}
            <tr>
                <td>{{ forloop.counter }}</td> <!-- ✅ هذا هو عمود التسلسل -->
                <td>{{ t.from_department.name }}</td>
                <td>{{ t.from_room }}</td>
                <td>{{ t.to_department.name }}</td>
                <td>{{ t.to_room }}</td>
                <td>{{ t.requested_by.username }}</td>
                <td>{{ t.requested_at|date:"Y-m-d H:i" }}</td>
                <td>{% if t.is_approved %}{{ t.approved_by.username }}{% else %}<span class="text-warning">لم يُقبل بعد{% endif %}</span></td>
                <td>{% if t.is_approved %}{{ t.approved_at|date:"Y-m-d H:i" }}{% else %}—{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-danger text-center">لا توجد حركات مسجلة لهذا الجهاز.</p>
    {% endif %}

    <div class="text-center mt-4">
        <a href="{% url 'maintenance:device_detail' device.id %}" class="btn btn-secondary">رجوع لتفاصيل الجهاز</a>
    </div>
</div>
{% endblock %}