{% extends "base.html" %}

{% block title %}Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ÙÙŠ {{ department.name }}{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="text-primary mb-0">Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù‚Ø³Ù…: {{ department.name }}</h3>
        <div>
            <a href="{% url 'maintenance:all_devices_transfer' %}?from_department={{ department.id }}" class="btn btn-primary">
                <i class="fas fa-exchange-alt"></i> Ø·Ù„Ø¨ Ù†Ù‚Ù„ Ø¬Ù‡Ø§Ø²
            </a>
            <a href="{% url 'maintenance:department_transfer_requests' department.id %}" class="btn btn-info">
                <i class="fas fa-list"></i> Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ù‚Ù„ Ù„Ù„Ù‚Ø³Ù…
            </a>
        </div>
    </div>

    
    {% if actual_devices or requested_devices %}
        <h4 class="mt-4">ğŸŸ¢ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© ({{ actual_devices|length }})</h4>
        <table class="table table-striped table-bordered align-middle text-center">
            <thead class="table-success">
                <tr>
                     <th>Serial No.</th>
                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                    
                    <th>Ø§Ù„ØºØ±ÙØ©</th>
                   
                     <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                     <th>Ø§Ù„Ù†Ø¸Ø§ÙØ©</th>
                     <th>Ø§Ù„ØªØ¹Ù‚ÙŠÙ…</th>
                     <th>Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„Ø­Ø§Ù„ÙŠ</th> 
                    
                     <th>Start use</th>
                    <th>End use</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                </tr>
            </thead>
            <tbody>
                {% for device in actual_devices %}
                <tr>
                    <td>{{ device.id }}</td>
                    <td>{{ device.name }}</td>
                    
                    <td>{{ device.room }}</td>
                   
                    <td>{{ device.get_status_display }}</td>
                    <td>{{ device.get_clean_status_display }}</td>
                    <td>{{ device.get_sterilization_status_display }}</td>
                    <td>{{ device.current_patient }}</td>
                   
                    <td>
                        {% if device.status == 'working' and not device.current_patient %}
                        <a href="{% url 'maintenance:assign_device' device.id %}" class="btn btn-sm btn-primary">ğŸ“¥ Ø§Ø³ØªØ®Ø¯Ø§Ù…</a>
                         {% else %}
                        <span class="text-muted">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</span>
                                  {% endif %}
                   </td>

                   <td>
                      {% if device.current_patient %}
                      <a href="{% url 'maintenance:release_device' device.id %}" class="btn btn-sm btn-warning">â¹ï¸ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a>
                      {% else %}
                      <span class="text-muted">-</span>
                      {% endif %}
                    </td> 
                     <td>
                    <a href="{% url 'maintenance:device_detail' device.id %}" class="btn btn-sm btn-info" title="Open">ğŸ‘ï¸</a>
                    <a href="{% url 'maintenance:device_edit' device.id %}" class="btn btn-sm btn-warning" title="Edit">âœï¸</a>
                    <a href="{% url 'maintenance:device_delete' device.id %}" class="btn btn-sm btn-danger" title="Delete">ğŸ—‘ï¸</a>
                    <a href="{% url 'maintenance:device_transfer' device.id %}" class="btn btn-sm btn-secondary" title="Transfer">ğŸ”„</a>
                   </td>
                    <td><span class="text-success">âœ… Ù†Ø´Ø·</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <!-- Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¥Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© -->
        

        {% if false %}
        <h4 class="mt-5">ğŸŸ¡ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©)</h4>
        <table class="table table-striped table-bordered align-middle text-center">
            <thead class="table-warning">
                <tr>
                     <th>Serial No.</th>
                    <th>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
                    <th>Ù…Ù† Ø§Ù„Ù‚Ø³Ù…</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                </tr>
            </thead>
            <tbody>
                {% for request in requested_devices %}
                <tr>
                    <td>{{ request.device.id }}</td>
                    <td>{{ request.device.name }}</td>
                    <td>{{ request.from_department.name }}</td>
                    <td>{{ request.requested_at|date:"Y-m-d H:i" }}</td>
                    <td>
                        {% if request.status == 'pending' %}
                        <span class="badge badge-warning">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>
                        {% elif request.status == 'approved' %}
                        <span class="badge badge-success">ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© - Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        {% if pending_transfers %}
        <h4 class="mt-5">ğŸ“¥ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø© (Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©)</h4>
        <table class="table table-striped table-bordered align-middle text-center">
            <thead class="table-warning">
                <tr>
                     <th>Serial No.</th>
                    <th>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
                    <th>Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                    <th>Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø³Ù…</th>
                    <th>Ø·Ø§Ù„Ø¨ Ø§Ù„Ù†Ù‚Ù„</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                {% for transfer in pending_transfers %}
                <tr>
                    <td>{{ transfer.device.id }}</td>
                    <td>{{ transfer.device.name }}</td>
                    <td>{{ transfer.from_department.name }}</td>
                    <td>{{ transfer.to_department.name }}</td>
                    <td>{{ transfer.requested_by.username }}</td>
                    <td>
                        {% if transfer.status == 'pending' %}
                        <span class="badge badge-warning">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>
                        {% elif transfer.status == 'approved' %}
                        <span class="badge badge-info">ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if transfer.status == 'pending' %}
                        <div class="btn-group">
                            <form method="post" action="{% url 'maintenance:approve_transfer_request' transfer.id %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-success">âœ”ï¸ Ù…ÙˆØ§ÙÙ‚Ø©</button>
                            </form>
                            <form method="post" action="{% url 'maintenance:reject_transfer_request' transfer.id %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-danger">âŒ Ø±ÙØ¶</button>
                            </form>
                        </div>
                        {% elif transfer.status == 'approved' %}
                        <span class="text-info">ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© - Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ù…Ù† Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        {% if outgoing_transfers %}
        <h4 class="mt-5">ğŸ“¤ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ({{ outgoing_transfers|length }})</h4>
        <table class="table table-striped table-bordered align-middle text-center">
            <thead class="table-info">
                <tr>
                     <th>Serial No.</th>
                    <th>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
                    <th>Ø¥Ù„Ù‰ Ù‚Ø³Ù…</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                {% for transfer in outgoing_transfers %}
                <tr>
                    <td>{{ transfer.device.id }}</td>
                    <td>{{ transfer.device.name }}</td>
                    <td>{{ transfer.to_department.name }}</td>
                    <td>{{ transfer.requested_at|date:"Y-m-d H:i" }}</td>
                    <td>
                        {% if transfer.status == 'pending' %}
                        <span class="badge badge-warning">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>
                        {% elif transfer.status == 'approved' %}
                        <span class="badge badge-info">ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© - Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„</span>
                        {% else %}
                        <span class="badge badge-secondary">{{ transfer.get_status_display }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'maintenance:transfer_request_detail' transfer.pk %}" class="btn btn-sm btn-info">
                            <i class="fas fa-eye"></i> Ø¹Ø±Ø¶
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
    {% else %}
        <p class="text-danger text-center mt-5">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¬Ù‡Ø²Ø© Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù….</p>
    {% endif %}
    <div class="text-center mt-4">
        <a href="{% url 'manager:department_page' department.id %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ù‚Ø³Ù…
        </a>
    </div>
</div>
{% endblock %}